<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon_io/apple-touch-icon.png"><link rel="icon" href="/img/favicon_io/favicon.ico"><link rel="canonical" href="https://mundi-xu.github.io/2021/03/02/Use-IPy-to-determine-the-legitimacy-of-an-IP-address/"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="煊宇"><meta name="keywords" content="LLM Security"><meta property="article:published_time" content="2021-03-02T15:00:11.000Z"><meta property="article:modified_time" content="2021-03-26T13:05:21.000Z"><meta property="article:section" content="Software Development"><meta property="article:tag" content="ipy"><meta property="article:tag" content="python"><meta property="article:tag" content="Network Programming"><meta name="google-site-verification" content="8weHOmi2lqvnOxDE30WJFT51umo63nyCgfm8dXHNT5g"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><link rel="dns-prefetch" href="//at.alicdn.com"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//raw.githubusercontent.com"><link rel="dns-prefetch" href="//busuanzi.ibruce.info"><link rel="preconnect" href="https://at.alicdn.com" crossorigin><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin><link rel="preconnect" href="https://busuanzi.ibruce.info" crossorigin><link rel="dns-prefetch" href="//www.googletagmanager.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/LXGWWenKaiScreen-Regular.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"></noscript><link rel="preload" href="/css/main.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/events.js" as="script"><link rel="preload" href="/js/plugins.js" as="script"><link rel="preload" href="/js/boot.js" as="script"><link rel="preload" href="/js/img-lazyload.js" as="script"><meta name="description" content="介绍如何使用Python的IPy模块处理和判断IP地址的合法性，附带IP地址格式规范和源码简析"><meta property="og:type" content="article"><meta property="og:title" content="利用IPy判断IP地址的合法性"><meta property="og:url" content="https://mundi-xu.github.io/2021/03/02/Use-IPy-to-determine-the-legitimacy-of-an-IP-address/index.html"><meta property="og:site_name" content="Hanyin&#39;s Space"><meta property="og:description" content="介绍如何使用Python的IPy模块处理和判断IP地址的合法性，附带IP地址格式规范和源码简析"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2021-03-02T15:00:11.000Z"><meta property="article:modified_time" content="2021-03-26T13:05:21.000Z"><meta property="article:author" content="煊宇"><meta property="article:tag" content="ipy"><meta property="article:tag" content="python"><meta property="article:tag" content="Network Programming"><meta name="twitter:card" content="summary_large_image"><meta name="format-detection" content="telephone=no"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hanyin&#39;s Space"><meta name="referrer" content="no-referrer-when-downgrade"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="apple-touch-icon" sizes="180x180" href="/img/favicon_io/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon_io/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon_io/favicon-16x16.png"><link rel="manifest" href="/img/favicon_io/site.webmanifest"><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "利用IPy判断IP地址的合法性",
    "author": {
      "@type": "Person",
      "name": "煊宇"
    },
    "datePublished": "2021-03-02T15:00:11.000Z",
    
    "dateModified": "2021-03-26T13:05:21.000Z",
    
    "description": "介绍如何使用Python的IPy模块处理和判断IP地址的合法性，附带IP地址格式规范和源码简析",
    
    "publisher": {
      "@type": "Organization",
      "name": "Hanyin&#39;s Space",
      
      "logo": {
        "@type": "ImageObject",
        "url": "/img/favicon_io/favicon.ico"
      }
      
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://mundi-xu.github.io/2021/03/02/Use-IPy-to-determine-the-legitimacy-of-an-IP-address/index.html"
    },
    
    "keywords": "ipy,python,Network Programming",
    
    
    "articleBody": "ip地址格式规范 ipv4 在CIDR表示法中，前缀显示为4个八位字节，就像传统的IPv4地址一样，后跟”/“斜杠和一个0～32之间的十进制值来描述有效位数。[1]  For example, the legacy “Class B” network 172.16.0.0, with an implied network mask of 255.255.0.0, is defined as the prefix 172.16.0.0/16, the “/16” indicating that the mask to extract the network portion of the prefix is a 32-bit value where the most significant 16 bits are ones and the least significant 16 bits are zeros. Similarly, the legacy “Class C” network number 192.168.99.0 is defined as the prefix 192.1"
    
  }</script><title>利用IPy判断IP地址的合法性 - Hanyin&#39;s Space</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hint.css/3.0.0/hint.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"mundi-xu.github.io",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:80,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!0,offset_factor:3},web_analytics:{enable:!0,follow_dnt:!1,google:{measurement_id:"G-3847WCVNF2"}},search_path:"/local-search.json",include_content_in_search:!0};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-3847WCVNF2",function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","G-3847WCVNF2")})</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Hanyin's Space" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Hanyin&#39;s Space</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archives</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>Categories</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>Tags</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>Links</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" rel="external nofollow noreferrer" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" rel="external nofollow noreferrer" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/banner.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="利用IPy判断IP地址的合法性"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-03-02 23:00" pubdate>March 2, 2021 pm</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 11k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 94 mins </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> views</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Software Development" id="heading-f287f429e4026672e5754c1201691e49" role="tab" data-toggle="collapse" href="#collapse-f287f429e4026672e5754c1201691e49" aria-expanded="true">Software Development <span class="list-group-count">(7)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-f287f429e4026672e5754c1201691e49" role="tabpanel" aria-labelledby="heading-f287f429e4026672e5754c1201691e49"><div class="category-post-list"><a href="/2021/08/15/Basics-of-Chrome-V8-3/" title="Chrome V8基础（三）" class="list-group-item list-group-item-action"><span class="category-post">Chrome V8基础（三）</span> </a><a href="/2021/07/29/Basics-of-Chrome-V8-2/" title="Chrome V8基础（二）" class="list-group-item list-group-item-action"><span class="category-post">Chrome V8基础（二）</span> </a><a href="/2021/07/27/Basics-of-Chrome-V8-1/" title="Chrome V8基础（一）" class="list-group-item list-group-item-action"><span class="category-post">Chrome V8基础（一）</span> </a><a href="/2021/03/10/MySQL8-under-Kunpeng/" title="华为鲲鹏服务器下MySQL8的安装与远程连接配置" class="list-group-item list-group-item-action"><span class="category-post">华为鲲鹏服务器下MySQL8的安装与远程连接配置</span> </a><a href="/2021/03/02/Use-IPy-to-determine-the-legitimacy-of-an-IP-address/" title="利用IPy判断IP地址的合法性" class="list-group-item list-group-item-action active"><span class="category-post">利用IPy判断IP地址的合法性</span> </a><a href="/2019/11/01/stl-list-implementation/" title="stl-list实现分析" class="list-group-item list-group-item-action"><span class="category-post">stl-list实现分析</span> </a><a href="/2019/08/21/Learn-through-automatic-play-mode/" title="超星学习通开启自动播放模式" class="list-group-item list-group-item-action"><span class="category-post">超星学习通开启自动播放模式</span></a></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">利用IPy判断IP地址的合法性</h1><p id="updated-time" class="note note-primary" style="display:none">Last updated on 2021-03-26T21:05:21+08:00</p><div class="markdown-body"><h1 id="ip地址格式规范">ip地址格式规范</h1><h2 id="ipv4">ipv4</h2><p>在CIDR表示法中，前缀显示为4个八位字节，就像传统的IPv4地址一样，后跟”/“斜杠和一个0～32之间的十进制值来描述有效位数。<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="RFC 791; RFC 4632">[1]</span></a></sup></p><blockquote><p>For example, the legacy “Class B” network 172.16.0.0, with an implied network mask of 255.255.0.0, is defined as the prefix 172.16.0.0/16, the “/16” indicating that the mask to extract the network portion of the prefix is a 32-bit value where the most significant 16 bits are ones and the least significant 16 bits are zeros.<br>Similarly, the legacy “Class C” network number 192.168.99.0 is defined as the prefix 192.168.99.0/24; the most significant 24 bits are ones and the least significant 8 bits are zeros.</p></blockquote><h2 id="ipv6">ipv6</h2><p>There are three conventional forms for representing IPv6 addresses as text strings: <sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="RFC 2373">[2]</span></a></sup></p><ol type="1"><li><p>The preferred form is <code>x:x:x:x:x:x:x:x</code>, where the ’x’s are the hexadecimal values of the eight 16-bit pieces of the address. Examples:</p><p><code>FEDC:BA98:7654:3210:FEDC:BA98:7654:3210</code></p><p><code>1080:0:0:0:8:800:200C:417A</code></p><p>Note that it is not necessary to write the leading zeros in an individual field, but there must be at least one numeral in every field (except for the case described in 2.).</p></li><li><p>Due to some methods of allocating certain styles of IPv6 addresses, it will be common for addresses to contain long strings of zero bits. In order to make writing addresses containing zero bits easier a special syntax is available to compress the zeros. The use of “::” indicates multiple groups of 16-bits of zeros. The “::” can only appear once in an address. The “::” can also be used to compress the leading and/or trailing zeros in an address. For example the following addresses:</p><p><code>1080:0:0:0:8:800:200C:417A</code> a unicast address</p><p><code>FF01:0:0:0:0:0:0:101</code> a multicast address</p><p><code>0:0:0:0:0:0:0:1</code> the loopback address</p><p><code>0:0:0:0:0:0:0:0</code> the unspecified addresses</p><p>may be represented as:</p><p><code>1080::8:800:200C:417A</code> a unicast address</p><p><code>FF01::101</code> a multicast address</p><p><code>::1</code> the loopback address</p><p><code>::</code> the unspecified addresses</p></li><li><p>An alternative form that is sometimes more convenient when dealing with a mixed environment of IPv4 and IPv6 nodes is <code>x:x:x:x:x:x:d.d.d.d</code>, where the ’x’s are the hexadecimal values of the six high-order 16-bit pieces of the address, and the ’d’s are the decimal values of the four low-order 8-bit pieces of the address (standard IPv4 representation). Examples:</p><p><code>0:0:0:0:0:0:13.1.68.3</code></p><p><code>0:0:0:0:0:FFFF:129.144.52.38</code></p><p>or in compressed form:</p><p><code>::13.1.68.3</code></p><p><code>::FFFF:129.144.52.38</code></p></li></ol><p>IPv6地址前缀的文本表示类似于以CIDR表示法编写IPv4地址前缀的方式: IPv6地址/有效位数</p><h1 id="ipy模块的使用">IPy模块的使用</h1><p>安装Ipy模块</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install IPy<br></code></pre></td></tr></table></figure><p>IPy模块包含IP类，使用它可以处理绝大部分格式的IPv4或IPv6地址<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="">[3]</span></a></sup>。</p><blockquote><p>It can detect about a dozen different ways of expressing IP addresses and networks, parse them and distinguish between IPv4 and IPv6 addresses:</p></blockquote><p>通过version方法来区分出IPv4和IPv6</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>IP(<span class="hljs-string">&#x27;10.0.0.0/8&#x27;</span>).version()<br><span class="hljs-number">4</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>IP(<span class="hljs-string">&#x27;::1&#x27;</span>).version()<br><span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><p>通过strNormal指定不同的wantprefixlen值控制输出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>IP(<span class="hljs-string">&#x27;10.0.0.0/32&#x27;</span>).strNormal()<br><span class="hljs-string">&#x27;10.0.0.0&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>IP(<span class="hljs-string">&#x27;10.0.0.0/24&#x27;</span>).strNormal()<br><span class="hljs-string">&#x27;10.0.0.0/24&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>IP(<span class="hljs-string">&#x27;10.0.0.0/24&#x27;</span>).strNormal(<span class="hljs-number">0</span>)<br><span class="hljs-string">&#x27;10.0.0.0&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>IP(<span class="hljs-string">&#x27;10.0.0.0/24&#x27;</span>).strNormal(<span class="hljs-number">1</span>)<br><span class="hljs-string">&#x27;10.0.0.0/24&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>IP(<span class="hljs-string">&#x27;10.0.0.0/24&#x27;</span>).strNormal(<span class="hljs-number">2</span>)<br><span class="hljs-string">&#x27;10.0.0.0/255.255.255.0&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>IP(<span class="hljs-string">&#x27;10.0.0.0/24&#x27;</span>).strNormal(<span class="hljs-number">3</span>)<br><span class="hljs-string">&#x27;10.0.0.0-10.0.0.255&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>ip = IP(<span class="hljs-string">&#x27;10.0.0.0&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(ip)<br><span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>ip.NoPrefixForSingleIp = <span class="hljs-literal">None</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(ip)<br><span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">32</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>ip.WantPrefixLen = <span class="hljs-number">3</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(ip)<br><span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>-<span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br></code></pre></td></tr></table></figure><h1 id="实现代码">实现代码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> IPy <span class="hljs-keyword">import</span> IP<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_ip</span>(<span class="hljs-params">ip_str</span>):<br>	<span class="hljs-keyword">try</span>:<br>		ip = IP(ip_str)<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>	<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>		<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;The address is illegal.&quot;</span>)<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>ip_str = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Please enter the IP address:\n &quot;</span>)<br><span class="hljs-keyword">if</span> is_ip(ip_str):<br>	ip = IP(ip_str)<br>	version = ip.version()<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;The address is IPv&quot;</span>, version, sep=<span class="hljs-string">&#x27;&#x27;</span>)<br>	<span class="hljs-keyword">if</span> ip.<span class="hljs-built_in">len</span>() &gt; <span class="hljs-number">1</span>:<br>		<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Available address segment is:&quot;</span>, ip.strNormal(<span class="hljs-number">3</span>))<br>		<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;The number of address is:&quot;</span>, ip.<span class="hljs-built_in">len</span>())<br>	<span class="hljs-keyword">else</span>:<br>		<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;The binary address is:&quot;</span>, ip.strBin())<br><br></code></pre></td></tr></table></figure><h1 id="测试结果">测试结果</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs log">testcase 1<br>Please enter the IP address:<br> 0.0.0.0<br>The address is IPv4<br>The binary address is: 00000000000000000000000000000000<br>---------------------------------<br>testcase 2<br>Please enter the IP address:<br> 255.255.255.255<br>The address is IPv4<br>The binary address is: 11111111111111111111111111111111<br>---------------------------------<br>testcase 3<br>Please enter the IP address:<br> 256.0.1.1<br>The address is illegal.<br>---------------------------------<br>testcase 4<br>Please enter the IP address:<br> 192.168.0.0/24<br>The address is IPv4<br>Available address segment is: 192.168.0.0-192.168.0.255<br>The number of address is: 256<br>---------------------------------<br>testcase 5<br>Please enter the IP address:<br> 192.168.1.1/24<br>The address is illegal.<br>---------------------------------<br>testcase 6<br>Please enter the IP address:<br> ::1/128<br>The address is IPv6<br>The binary address is: 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001<br>---------------------------------<br>testcase 7<br>Please enter the IP address:<br> FEDC:BA98:7654:3210:FEDC:BA98:7654:3210<br>The address is IPv6<br>The binary address is: 11111110110111001011101010011000011101100101010000110010000100001111111011011100101110101001100001110110010101000011001000010000<br>---------------------------------<br>testcase 8<br>Please enter the IP address:<br> 1080::8:800:200C:417A/24<br>The address is illegal.<br>---------------------------------<br>testcase 9<br>Please enter the IP address:<br> FF01::101<br>The address is IPv6<br>The binary address is: 11111111000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000001<br>---------------------------------<br>testcase 10<br>Please enter the IP address:<br> ::<br>The address is IPv6<br>The binary address is: 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br>---------------------------------<br>testcase 11<br>Please enter the IP address:<br> ::/64<br>The address is IPv6<br>Available address segment is: 0:0:0:0:0:0:0:0-0000:0000:0000:0000:ffff:ffff:ffff:ffff<br>The number of address is: 18446744073709551616<br>---------------------------------<br></code></pre></td></tr></table></figure><h1 id="ipy源码分析">IPy源码分析</h1><blockquote><p>IPy - class and tools for handling of IPv4 and IPv6 addresses and networks.</p></blockquote><p>源码版本为1.01 <code>__version__ = '1.01'</code> <sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="">[4]</span></a></sup></p><h2 id="ipversion">ipversion</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(data, INT_TYPES):<br>    <span class="hljs-variable language_">self</span>.ip = <span class="hljs-built_in">int</span>(data)<br>    <span class="hljs-keyword">if</span> ipversion == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.ip &lt;= MAX_IPV4_ADDRESS:<br>            ipversion = <span class="hljs-number">4</span><br>        <span class="hljs-keyword">else</span>:<br>            ipversion = <span class="hljs-number">6</span><br>    <span class="hljs-keyword">if</span> ipversion == <span class="hljs-number">4</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.ip &gt; MAX_IPV4_ADDRESS:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;IPv4 Address can&#x27;t be larger than %x: %x&quot;</span> % (MAX_IPV4_ADDRESS, <span class="hljs-variable language_">self</span>.ip))<br>        prefixlen = <span class="hljs-number">32</span><br>    <span class="hljs-keyword">elif</span> ipversion == <span class="hljs-number">6</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.ip &gt; MAX_IPV6_ADDRESS:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;IPv6 Address can&#x27;t be larger than %x: %x&quot;</span> % (MAX_IPV6_ADDRESS, <span class="hljs-variable language_">self</span>.ip))<br>        prefixlen = <span class="hljs-number">128</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;only IPv4 and IPv6 supported&quot;</span>)<br></code></pre></td></tr></table></figure><p>根据处理后的ip长度判断类型，其中<code>MAX_IPV4_ADDRESS = 0xffffffff, MAX_IPV6_ADDRESS = 0xffffffffffffffffffffffffffffffff</code></p><h2 id="strbin">strbin</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">bits = _ipVersionToLen(<span class="hljs-variable language_">self</span>._ipversion)<br><span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.WantPrefixLen == <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> wantprefixlen == <span class="hljs-literal">None</span>:<br>	wantprefixlen = <span class="hljs-number">0</span><br>ret = _intToBin(<span class="hljs-variable language_">self</span>.ip)<br><span class="hljs-keyword">return</span>  <span class="hljs-string">&#x27;0&#x27;</span> * (bits - <span class="hljs-built_in">len</span>(ret)) + ret + <span class="hljs-variable language_">self</span>._printPrefix(wantprefixlen)<br></code></pre></td></tr></table></figure><h2 id="strnormal">strnormal</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.WantPrefixLen == <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> wantprefixlen == <span class="hljs-literal">None</span>:<br>	wantprefixlen = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._ipversion == <span class="hljs-number">4</span>:<br>	ret = <span class="hljs-variable language_">self</span>.strFullsize(<span class="hljs-number">0</span>) <span class="hljs-comment"># Return a string representation in the non-mangled format.</span><br><span class="hljs-keyword">elif</span> <span class="hljs-variable language_">self</span>._ipversion == <span class="hljs-number">6</span>:<br>	ret = <span class="hljs-string">&#x27;:&#x27;</span>.join([<span class="hljs-string">&quot;%x&quot;</span> % x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> [<span class="hljs-built_in">int</span>(x, <span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.strFullsize(<span class="hljs-number">0</span>).split(<span class="hljs-string">&#x27;:&#x27;</span>)]])<br><span class="hljs-keyword">else</span>:<br>	<span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;only IPv4 and IPv6 supported&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="len">len</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">bits = _ipVersionToLen(<span class="hljs-variable language_">self</span>._ipversion) <span class="hljs-comment"># Return number of bits in address for a certain IP version.(32 or 128)</span><br>locallen = bits - <span class="hljs-variable language_">self</span>._prefixlen<br><span class="hljs-keyword">return</span> <span class="hljs-number">2</span> ** locallen<br></code></pre></td></tr></table></figure><p>范围IP分解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(key, <span class="hljs-built_in">slice</span>):<br>	<span class="hljs-keyword">return</span> [IP(IPint.__getitem__(<span class="hljs-variable language_">self</span>, x), ipversion=<span class="hljs-variable language_">self</span>._ipversion) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(*key.indices(<span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>)))]<br>	<span class="hljs-keyword">return</span> IP(IPint.__getitem__(<span class="hljs-variable language_">self</span>, key), ipversion=<span class="hljs-variable language_">self</span>._ipversion)<br></code></pre></td></tr></table></figure><h2 id="getipv4map">getIPv4Map</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._ipversion != <span class="hljs-number">6</span>:<br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">self</span>.ip &gt;&gt; <span class="hljs-number">32</span>) != <span class="hljs-number">0xffff</span>:<br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>ipv4 = <span class="hljs-variable language_">self</span>.ip &amp; MAX_IPV4_ADDRESS<br><span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._prefixlen != <span class="hljs-number">128</span>:<br>	ipv4 = <span class="hljs-string">&#x27;%s/%s&#x27;</span> % (ipv4, <span class="hljs-number">32</span>-(<span class="hljs-number">128</span>-<span class="hljs-variable language_">self</span>._prefixlen))<br><span class="hljs-keyword">return</span> IP(ipv4, ipversion=<span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><h2 id="ip输入格式检测">IP输入格式检测</h2><p>解析字符串并返回相应的整数型IP地址</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">parseAddress</span>(<span class="hljs-params">ipstr, ipversion=<span class="hljs-number">0</span></span>):<br>    <span class="hljs-keyword">try</span>:<br>        hexval = <span class="hljs-built_in">int</span>(ipstr, <span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">except</span> ValueError:<br>        hexval = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">try</span>:<br>        intval = <span class="hljs-built_in">int</span>(ipstr, <span class="hljs-number">10</span>)<br>    <span class="hljs-keyword">except</span> ValueError:<br>        intval = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">if</span> ipstr.startswith(<span class="hljs-string">&#x27;0x&#x27;</span>) <span class="hljs-keyword">and</span> hexval <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">if</span> hexval &gt; MAX_IPV6_ADDRESS:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;IP Address can&#x27;t be larger than %x: %x&quot;</span> % (MAX_IPV6_ADDRESS, hexval))<br>        <span class="hljs-keyword">if</span> hexval &lt;= MAX_IPV4_ADDRESS:<br>            <span class="hljs-keyword">return</span> (hexval, <span class="hljs-number">4</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> (hexval, <span class="hljs-number">6</span>)<br><br>    <span class="hljs-keyword">if</span> ipstr.find(<span class="hljs-string">&#x27;:&#x27;</span>) != -<span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> (_parseAddressIPv6(ipstr), <span class="hljs-number">6</span>)<br><br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(ipstr) == <span class="hljs-number">32</span> <span class="hljs-keyword">and</span> hexval <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># assume IPv6 in pure hexadecimal notation</span><br>        <span class="hljs-keyword">return</span> (hexval, <span class="hljs-number">6</span>)<br><br>    <span class="hljs-keyword">elif</span> ipstr.find(<span class="hljs-string">&#x27;.&#x27;</span>) != -<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> (intval <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> intval &lt; <span class="hljs-number">256</span> <span class="hljs-keyword">and</span> ipversion != <span class="hljs-number">6</span>):<br>        <span class="hljs-comment"># assume IPv4  (&#x27;127&#x27; gets interpreted as &#x27;127.0.0.0&#x27;)</span><br>        <span class="hljs-built_in">bytes</span> = ipstr.split(<span class="hljs-string">&#x27;.&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bytes</span>) &gt; <span class="hljs-number">4</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;IPv4 Address with more than 4 bytes&quot;</span>)<br>        <span class="hljs-built_in">bytes</span> += [<span class="hljs-string">&#x27;0&#x27;</span>] * (<span class="hljs-number">4</span> - <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bytes</span>))<br>        <span class="hljs-built_in">bytes</span> = [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">bytes</span>]<br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">bytes</span>:<br>            <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">255</span> <span class="hljs-keyword">or</span> x &lt; <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;%r: single byte must be 0 &lt;= byte &lt; 256&quot;</span> % (ipstr))<br>        <span class="hljs-keyword">return</span> ((<span class="hljs-built_in">bytes</span>[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-number">24</span>) + (<span class="hljs-built_in">bytes</span>[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">16</span>) + (<span class="hljs-built_in">bytes</span>[<span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">8</span>) + <span class="hljs-built_in">bytes</span>[<span class="hljs-number">3</span>], <span class="hljs-number">4</span>)<br><br>    <span class="hljs-keyword">elif</span> intval <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># we try to interprete it as a decimal digit -</span><br>        <span class="hljs-comment"># this ony works for numbers &gt; 255 ... others</span><br>        <span class="hljs-comment"># will be interpreted as IPv4 first byte</span><br>        <span class="hljs-keyword">if</span> intval &gt; MAX_IPV6_ADDRESS:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;IP Address can&#x27;t be larger than %x: %x&quot;</span> % (MAX_IPV6_ADDRESS, intval))<br>        <span class="hljs-keyword">if</span> intval &lt;= MAX_IPV4_ADDRESS <span class="hljs-keyword">and</span> ipversion != <span class="hljs-number">6</span>:<br>            <span class="hljs-keyword">return</span> (intval, <span class="hljs-number">4</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> (intval, <span class="hljs-number">6</span>)<br><br>    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;IP Address format was invalid: %s&quot;</span> % ipstr)<br></code></pre></td></tr></table></figure><p>分解IPv6地址</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_parseAddressIPv6</span>(<span class="hljs-params">ipstr</span>):<br><br>    items = []<br>    index = <span class="hljs-number">0</span><br>    fill_pos = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">while</span> index &lt; <span class="hljs-built_in">len</span>(ipstr):<br>        text = ipstr[index:]<br>        <span class="hljs-keyword">if</span> text.startswith(<span class="hljs-string">&quot;::&quot;</span>):<br>            <span class="hljs-keyword">if</span> fill_pos <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                <span class="hljs-comment"># Invalid IPv6, eg. &#x27;1::2::&#x27;</span><br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;%r: Invalid IPv6 address: more than one &#x27;::&#x27;&quot;</span> % ipstr)<br>            fill_pos = <span class="hljs-built_in">len</span>(items)<br>            index += <span class="hljs-number">2</span><br>            <span class="hljs-keyword">continue</span><br>        pos = text.find(<span class="hljs-string">&#x27;:&#x27;</span>)<br>        <span class="hljs-keyword">if</span> pos == <span class="hljs-number">0</span>:<br>            <span class="hljs-comment"># Invalid IPv6, eg. &#x27;1::2:&#x27;</span><br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;%r: Invalid IPv6 address&quot;</span> % ipstr)<br>        <span class="hljs-keyword">if</span> pos != -<span class="hljs-number">1</span>:<br>            items.append(text[:pos])<br>            <span class="hljs-keyword">if</span> text[pos:pos+<span class="hljs-number">2</span>] == <span class="hljs-string">&quot;::&quot;</span>:<br>                index += pos<br>            <span class="hljs-keyword">else</span>:<br>                index += pos+<span class="hljs-number">1</span><br><br>            <span class="hljs-keyword">if</span> index == <span class="hljs-built_in">len</span>(ipstr):<br>                <span class="hljs-comment"># Invalid IPv6, eg. &#x27;1::2:&#x27;</span><br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;%r: Invalid IPv6 address&quot;</span> % ipstr)<br>        <span class="hljs-keyword">else</span>:<br>            items.append(text)<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">if</span> items <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-keyword">in</span> items[-<span class="hljs-number">1</span>]:<br>        <span class="hljs-comment"># IPv6 ending with IPv4 like &#x27;::ffff:192.168.0.1&#x27;</span><br>        <span class="hljs-keyword">if</span> (fill_pos <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> (fill_pos &lt;= <span class="hljs-built_in">len</span>(items)-<span class="hljs-number">1</span>):<br>            <span class="hljs-comment"># Invalid IPv6: &#x27;ffff:192.168.0.1::&#x27;</span><br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;%r: Invalid IPv6 address: &#x27;::&#x27; after IPv4&quot;</span> % ipstr)<br>        value = parseAddress(items[-<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>]<br>        items = items[:-<span class="hljs-number">1</span>] + [<span class="hljs-string">&quot;%04x&quot;</span> % (value &gt;&gt; <span class="hljs-number">16</span>), <span class="hljs-string">&quot;%04x&quot;</span> % (value &amp; <span class="hljs-number">0xffff</span>)]<br><br>    <span class="hljs-comment"># Expand fill_pos to fill with &#x27;0&#x27;</span><br>    <span class="hljs-comment"># [&#x27;1&#x27;,&#x27;2&#x27;] with fill_pos=1 =&gt; [&#x27;1&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;2&#x27;]</span><br>    <span class="hljs-keyword">if</span> fill_pos <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        diff = <span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(items)<br>        <span class="hljs-keyword">if</span> diff &lt;= <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;%r: Invalid IPv6 address: &#x27;::&#x27; is not needed&quot;</span> % ipstr)<br>        items = items[:fill_pos] + [<span class="hljs-string">&#x27;0&#x27;</span>]*diff + items[fill_pos:]<br><br>    <span class="hljs-comment"># Here we have a list of 8 strings</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(items) != <span class="hljs-number">8</span>:<br>        <span class="hljs-comment"># Invalid IPv6, eg. &#x27;1:2:3&#x27;</span><br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;%r: Invalid IPv6 address: should have 8 hextets&quot;</span> % ipstr)<br><br>    <span class="hljs-comment"># Convert strings to long integer</span><br>    value = <span class="hljs-number">0</span><br>    index = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:<br>        <span class="hljs-keyword">try</span>:<br>            item = <span class="hljs-built_in">int</span>(item, <span class="hljs-number">16</span>)<br>            error = <span class="hljs-keyword">not</span>(<span class="hljs-number">0</span> &lt;= item &lt;= <span class="hljs-number">0xffff</span>)<br>        <span class="hljs-keyword">except</span> ValueError:<br>            error = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">if</span> error:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;%r: Invalid IPv6 address: invalid hexlet %r&quot;</span> % (ipstr, item))<br>        value = (value &lt;&lt; <span class="hljs-number">16</span>) + item<br>        index += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> value<br></code></pre></td></tr></table></figure><p>通过分割移位的方式转换输入为IP</p><h1 id="参考链接">参考链接</h1><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>RFC 791; RFC 4632 <a href="#fnref:1" rev="footnote" class="footnote-backref">↩︎</a></span></span></li><li><span id="fn:2" class="footnote-text"><span>RFC 2373 <a href="#fnref:2" rev="footnote" class="footnote-backref">↩︎</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://pypi.org/project/IPy/#description" class="uri">https://pypi.org/project/IPy/#description</a> <a href="#fnref:3" rev="footnote" class="footnote-backref">↩︎</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://github.com/autocracy/python-ipy" class="uri">https://github.com/autocracy/python-ipy</a> <a href="#fnref:4" rev="footnote" class="footnote-backref">↩︎</a></span></span></li></ol></div></section></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Software-Development/" class="category-chain-item">Software Development</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/ipy/" class="print-no-link">#ipy</a> <a href="/tags/python/" class="print-no-link">#python</a> <a href="/tags/Network-Programming/" class="print-no-link">#Network Programming</a></div></div><div class="license-box my-3"><div class="license-title"><div>利用IPy判断IP地址的合法性</div><div>https://mundi-xu.github.io/2021/03/02/Use-IPy-to-determine-the-legitimacy-of-an-IP-address/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>煊宇</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>March 2, 2021</div></div><div class="license-meta-item"><div>Licensed under</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/" rel="external nofollow noreferrer"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-cc-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/" rel="external nofollow noreferrer"><span class="hint--top hint--rounded" aria-label="NC - Non-commercial"><i class="iconfont icon-cc-nc"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2021/03/10/MySQL8-under-Kunpeng/" title="华为鲲鹏服务器下MySQL8的安装与远程连接配置"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">华为鲲鹏服务器下MySQL8的安装与远程连接配置</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/2021/02/23/recent-technology-of-symbolic-execution/" title="【转载】带你搞懂符号执行的前世今生与最近技术"><span class="hidden-mobile">【转载】带你搞懂符号执行的前世今生与最近技术</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments"><div id="giscus" class="giscus"></div><script type="text/javascript">Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"Mundi-Xu/mundi-xu.github.io","repo-id":"MDEwOlJlcG9zaXRvcnkxNTQ1OTg4Mjg=","category":"Announcements","category-id":"DIC_kwDOCTb9rM4CeUGi","theme-light":"light","theme-dark":"dark","mapping":"title","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN","strict":0};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="mailto:mundi.xu@gmail.com?subject=Interested+In+Your+Blog" rel="external nofollow noreferrer" target="_blank"><span>Contact me</span></a> <i class="iconfont icon-love"></i> <a href="mailto:mundi.xu@gmail.com?subject=Interested+In+Your+Blog" rel="external nofollow noreferrer" target="_blank"><span>mundi.xu@gmail.com</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">Views: <span id="busuanzi_value_site_pv"></span> </span><span id="busuanzi_container_site_uv" style="display:none">Visitors: <span id="busuanzi_value_site_uv"></span></span></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.1.0/typed.umd.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>var relativeDate=function(){var t,e,a,d,i=document.getElementById("updated-time");i&&(e=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|[+-]\d{2}:\d{2})/,(a=(t=i.textContent).match(e))&&(d=dayjs(a[0]).fromNow(),i.textContent=t.replace(e,d)),i.style.display="")};Fluid.utils.createScript("https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.13/dayjs.min.js",function(){Fluid.utils.createScript("https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.13/plugin/relativeTime.min.js",function(){dayjs.extend(dayjs_plugin_relativeTime),"en".startsWith("en")?relativeDate():Fluid.utils.createScript("https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.13/locale/en.min.js",function(){dayjs.locale("en"),relativeDate()})})})</script><script>Fluid.utils.createScript("https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.36.4/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://cdnjs.cloudflare.com/ajax/libs/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/DynamicLine.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>